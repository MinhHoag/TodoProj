<app-header></app-header>

<div class="login-page">
  <h2>Sign In</h2>

  <!-- Username Input with Validation -->
  <input
    #usernameModel="ngModel"
    [(ngModel)]="username"
    [appForbiddenNames]="['guest', 'admin']"
    [class.invalid]="usernameModel.invalid && usernameModel.touched"
    autocomplete="username"
    name="username"
    pattern="^\S+$"
    placeholder="Username (no spaces)"
    required
  />
  <div *ngIf="usernameModel.invalid && usernameModel.touched" class="validation-error">
    <div *ngIf="usernameModel.errors?.['required']">Username is required.</div>
    <div *ngIf="usernameModel.errors?.['pattern']">Username cannot contain spaces.</div>
    <div *ngIf="usernameModel.errors?.['forbiddenName']">This username is not allowed.</div>
  </div>

  <!-- Password Input with Validation -->
  <input
    #passwordModel="ngModel"
    [(ngModel)]="password"
    [class.invalid]="passwordModel.invalid && passwordModel.touched"
    autocomplete="current-password"
    minlength="4"
    name="password"
    placeholder="Password"
    required
    type="password"
  />
  <div *ngIf="passwordModel.invalid && passwordModel.touched" class="validation-error">
    <div *ngIf="passwordModel.errors?.['required']">Password is required.</div>
    <div *ngIf="passwordModel.errors?.['minlength']">
      Password must be at least 4 characters.
    </div>
  </div>

  <!-- General Login Error -->
  <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>

  <!-- Buttons -->
  <div class="button-group">
    <button
      (click)="login()"
      [disabled]="usernameModel.invalid || passwordModel.invalid"
    >
      Log In
    </button>

    <div
      [class.disabled]="usernameExists || usernameModel.invalid || passwordModel.invalid"
      class="tooltip-wrapper"
    >
      <button
        (click)="signup()"
        [disabled]="usernameExists || usernameModel.invalid || passwordModel.invalid"
        class="signup-button"
      >
        Sign Up
      </button>
      <div *ngIf="usernameExists" class="tooltip">Username already exists</div>
    </div>
  </div>
</div>
